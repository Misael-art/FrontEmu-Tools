# üèóÔ∏è FrontEmu-Tools - Arquitetura T√©cnica

## 1. Arquitetura de Design

```mermaid
graph TD
    A[üë§ Usu√°rio] --> B[üñ•Ô∏è Interface PySide6]
    B --> C[üì± Application Layer]
    C --> D[üè¢ Domain Layer]
    C --> E[üîß Infrastructure Layer]
    
    subgraph "üé® Presentation Layer"
        B
        B1[MainWindow]
        B2[SystemInfoWidget]
        B3[DriveSelectionWidget]
        B4[LegacyDetectionWidget]
        B5[SystemStatsWidget]
        B --> B1
        B --> B2
        B --> B3
        B --> B4
        B --> B5
    end
    
    subgraph "üì± Application Layer"
        C
        C1[SystemInfoService]
        C2[DriveDetectionService]
        C3[LegacyDetectionService]
        C4[SystemStatsService]
        C5[ConfigurationService]
        C --> C1
        C --> C2
        C --> C3
        C --> C4
        C --> C5
    end
    
    subgraph "üè¢ Domain Layer"
        D
        D1[SystemInfo Entity]
        D2[Drive Entity]
        D3[LegacySystem Entity]
        D4[Configuration Entity]
        D5[Use Cases]
        D --> D1
        D --> D2
        D --> D3
        D --> D4
        D --> D5
    end
    
    subgraph "üîß Infrastructure Layer"
        E
        E1[File System Adapter]
        E2[Registry Adapter]
        E3[Process Adapter]
        E4[Configuration Repository]
        E5[Cache Manager]
        E --> E1
        E --> E2
        E --> E3
        E --> E4
        E --> E5
    end
    
    style A fill:#FFD700,stroke:#FFA500,stroke-width:3px
    style B fill:#87CEEB,stroke:#4682B4,stroke-width:2px
    style C fill:#98FB98,stroke:#32CD32,stroke-width:2px
    style D fill:#FFB6C1,stroke:#FF69B4,stroke-width:2px
    style E fill:#DDA0DD,stroke:#9370DB,stroke-width:2px
```

## 2. Descri√ß√£o das Tecnologias

### Frontend
- **PySide6** (Qt6) - Framework de interface gr√°fica moderna
- **Python 3.9+** - Linguagem principal do projeto
- **asyncio** - Programa√ß√£o ass√≠ncrona para opera√ß√µes n√£o-bloqueantes

### Backend/Core
- **Clean Architecture** - Padr√£o arquitetural para separa√ß√£o de responsabilidades
- **Dependency Injection** - Invers√£o de controle para baixo acoplamento
- **Repository Pattern** - Abstra√ß√£o de acesso a dados

### Infraestrutura
- **JSON/XML** - Formatos de configura√ß√£o e dados
- **Windows Registry** - Detec√ß√£o de sistemas legados
- **File System** - Opera√ß√µes de arquivo e links simb√≥licos

## 3. Defini√ß√µes de Rotas (Interface)

| Rota/Widget | Prop√≥sito |
|-------------|-----------|
| `/main` | Janela principal com navega√ß√£o entre m√≥dulos |
| `/system-info` | Exibi√ß√£o de informa√ß√µes do sistema |
| `/drive-selection` | Sele√ß√£o e configura√ß√£o de drives |
| `/legacy-detection` | Detec√ß√£o e migra√ß√£o de sistemas legados |
| `/system-stats` | Monitoramento em tempo real do sistema |
| `/configuration` | Configura√ß√µes gerais da aplica√ß√£o |

## 4. Defini√ß√µes de API (Servi√ßos Internos)

### 4.1 Core Services

**SystemInfoService**
```python
class SystemInfoService:
    """Servi√ßo para coleta de informa√ß√µes do sistema"""
    
    async def get_system_info() -> SystemInfo:
        """Retorna informa√ß√µes completas do sistema"""
        pass
    
    async def get_hardware_info() -> HardwareInfo:
        """Retorna informa√ß√µes de hardware"""
        pass
    
    async def get_os_info() -> OSInfo:
        """Retorna informa√ß√µes do sistema operacional"""
        pass
```

**DriveDetectionService**
```python
class DriveDetectionService:
    """Servi√ßo para detec√ß√£o e gerenciamento de drives"""
    
    async def detect_drives() -> List[Drive]:
        """Detecta todos os drives dispon√≠veis"""
        pass
    
    async def analyze_drive(drive_path: str) -> DriveAnalysis:
        """Analisa um drive espec√≠fico"""
        pass
    
    async def create_symbolic_links(source: str, target: str) -> bool:
        """Cria links simb√≥licos entre diret√≥rios"""
        pass
```

**LegacyDetectionService**
```python
class LegacyDetectionService:
    """Servi√ßo para detec√ß√£o de sistemas legados"""
    
    async def scan_legacy_systems() -> List[LegacySystem]:
        """Escaneia sistemas de emula√ß√£o existentes"""
        pass
    
    async def migrate_legacy_system(system: LegacySystem) -> MigrationResult:
        """Migra sistema legado para nova estrutura"""
        pass
    
    async def validate_migration(system: LegacySystem) -> ValidationResult:
        """Valida migra√ß√£o realizada"""
        pass
```

### 4.2 Tipos de Dados

**SystemInfo**
```python
@dataclass
class SystemInfo:
    os_name: str
    os_version: str
    architecture: str
    processor: str
    memory_total: int
    memory_available: int
    disk_usage: Dict[str, DiskUsage]
    timestamp: datetime
```

**Drive**
```python
@dataclass
class Drive:
    letter: str
    label: str
    file_system: str
    total_space: int
    free_space: int
    drive_type: DriveType
    is_ready: bool
```

**LegacySystem**
```python
@dataclass
class LegacySystem:
    name: str
    path: str
    emulator_type: EmulatorType
    configuration_files: List[str]
    rom_directories: List[str]
    save_directories: List[str]
    detected_date: datetime
```

## 5. Arquitetura do Servidor (Aplica√ß√£o Desktop)

```mermaid
graph TD
    A[üñ•Ô∏è Desktop Application] --> B[üéÆ Main Controller]
    B --> C[üìä Service Layer]
    C --> D[üóÉÔ∏è Repository Layer]
    D --> E[üíæ Data Sources]

    subgraph "üéÆ Controller Layer"
        B
        B1[MainWindowController]
        B2[SystemInfoController]
        B3[DriveController]
        B4[LegacyController]
        B --> B1
        B --> B2
        B --> B3
        B --> B4
    end

    subgraph "üìä Service Layer"
        C
        C1[SystemInfoService]
        C2[DriveDetectionService]
        C3[LegacyDetectionService]
        C4[ConfigurationService]
        C --> C1
        C --> C2
        C --> C3
        C --> C4
    end

    subgraph "üóÉÔ∏è Repository Layer"
        D
        D1[ConfigurationRepository]
        D2[SystemRepository]
        D3[CacheRepository]
        D --> D1
        D --> D2
        D --> D3
    end

    subgraph "üíæ Data Sources"
        E
        E1[JSON Files]
        E2[Windows Registry]
        E3[File System]
        E4[Memory Cache]
        E --> E1
        E --> E2
        E --> E3
        E --> E4
    end
```

## 6. Modelo de Dados

### 6.1 Defini√ß√£o do Modelo de Dados

```mermaid
erDiagram
    SYSTEM_INFO ||--o{ DRIVE : contains
    SYSTEM_INFO ||--o{ LEGACY_SYSTEM : detects
    DRIVE ||--o{ SYMBOLIC_LINK : creates
    LEGACY_SYSTEM ||--o{ MIGRATION_TASK : generates
    CONFIGURATION ||--o{ SETTING : contains

    SYSTEM_INFO {
        string id PK
        string os_name
        string os_version
        string architecture
        string processor
        int memory_total
        int memory_available
        datetime last_updated
    }

    DRIVE {
        string letter PK
        string label
        string file_system
        int total_space
        int free_space
        string drive_type
        boolean is_ready
        string system_info_id FK
    }

    LEGACY_SYSTEM {
        string id PK
        string name
        string path
        string emulator_type
        json configuration_files
        json rom_directories
        json save_directories
        datetime detected_date
        string system_info_id FK
    }

    SYMBOLIC_LINK {
        string id PK
        string source_path
        string target_path
        datetime created_date
        boolean is_active
        string drive_letter FK
    }

    MIGRATION_TASK {
        string id PK
        string task_type
        string status
        json source_data
        json target_data
        datetime created_date
        datetime completed_date
        string legacy_system_id FK
    }

    CONFIGURATION {
        string id PK
        string name
        string version
        datetime created_date
        datetime last_modified
    }

    SETTING {
        string key PK
        string value
        string data_type
        string description
        string configuration_id FK
    }
```

### 6.2 Linguagem de Defini√ß√£o de Dados (DDL)

**Configura√ß√£o Principal**
```json
{
  "application": {
    "name": "FrontEmu-Tools",
    "version": "1.0.0",
    "settings": {
      "auto_detect_drives": true,
      "auto_scan_legacy": true,
      "cache_enabled": true,
      "cache_duration": 3600,
      "log_level": "INFO",
      "theme": "dark",
      "language": "pt-BR"
    }
  },
  "drives": {
    "base_drive": "C:",
    "target_drive": "D:",
    "symbolic_links": {
      "enabled": true,
      "auto_create": true,
      "backup_original": true
    }
  },
  "legacy_detection": {
    "scan_paths": [
      "C:\\Program Files",
      "C:\\Program Files (x86)",
      "C:\\Users\\%USERNAME%\\Documents"
    ],
    "emulator_patterns": {
      "retroarch": ["retroarch.exe", "retroarch.cfg"],
      "pcsx2": ["pcsx2.exe", "inis\\PCSX2.ini"],
      "dolphin": ["Dolphin.exe", "User\\Config\\Dolphin.ini"],
      "cemu": ["Cemu.exe", "settings.xml"]
    }
  }
}
```

**Cache de Sistema**
```json
{
  "cache": {
    "system_info": {
      "timestamp": "2025-01-15T10:30:00Z",
      "ttl": 3600,
      "data": {
        "os_name": "Windows 11",
        "os_version": "10.0.22631",
        "architecture": "x64",
        "processor": "Intel Core i7-12700K",
        "memory_total": 34359738368,
        "memory_available": 17179869184
      }
    },
    "drives": {
      "timestamp": "2025-01-15T10:30:00Z",
      "ttl": 1800,
      "data": [
        {
          "letter": "C:",
          "label": "Windows",
          "file_system": "NTFS",
          "total_space": 1000204886016,
          "free_space": 500102443008,
          "drive_type": "Fixed",
          "is_ready": true
        },
        {
          "letter": "D:",
          "label": "Games",
          "file_system": "NTFS",
          "total_space": 2000409772032,
          "free_space": 1500307329024,
          "drive_type": "Fixed",
          "is_ready": true
        }
      ]
    }
  }
}
```

**Configura√ß√£o de Links Simb√≥licos**
```json
{
  "symbolic_links": [
    {
      "id": "retroarch_roms",
      "source_path": "C:\\RetroArch\\roms",
      "target_path": "D:\\Emulation\\ROMs",
      "created_date": "2025-01-15T10:30:00Z",
      "is_active": true,
      "backup_path": "C:\\RetroArch\\roms.backup"
    },
    {
      "id": "pcsx2_saves",
      "source_path": "C:\\PCSX2\\memcards",
      "target_path": "D:\\Emulation\\Saves\\PCSX2",
      "created_date": "2025-01-15T10:35:00Z",
      "is_active": true,
      "backup_path": "C:\\PCSX2\\memcards.backup"
    }
  ]
}
```

**Dados de Sistemas Legados Detectados**
```json
{
  "legacy_systems": [
    {
      "id": "retroarch_001",
      "name": "RetroArch",
      "path": "C:\\RetroArch",
      "emulator_type": "multi_system",
      "configuration_files": [
        "C:\\RetroArch\\retroarch.cfg",
        "C:\\RetroArch\\config\\*.cfg"
      ],
      "rom_directories": [
        "C:\\RetroArch\\roms"
      ],
      "save_directories": [
        "C:\\RetroArch\\saves",
        "C:\\RetroArch\\states"
      ],
      "detected_date": "2025-01-15T10:30:00Z",
      "migration_status": "pending"
    },
    {
      "id": "pcsx2_001",
      "name": "PCSX2",
      "path": "C:\\PCSX2",
      "emulator_type": "playstation2",
      "configuration_files": [
        "C:\\PCSX2\\inis\\PCSX2.ini",
        "C:\\PCSX2\\inis\\*.ini"
      ],
      "rom_directories": [
        "C:\\PCSX2\\games"
      ],
      "save_directories": [
        "C:\\PCSX2\\memcards",
        "C:\\PCSX2\\sstates"
      ],
      "detected_date": "2025-01-15T10:32:00Z",
      "migration_status": "completed"
    }
  ]
}
```

---

## üîß Implementa√ß√£o T√©cnica

### Padr√µes de Design Utilizados

1. **Clean Architecture** - Separa√ß√£o clara de responsabilidades
2. **Repository Pattern** - Abstra√ß√£o de acesso a dados
3. **Dependency Injection** - Invers√£o de controle
4. **Observer Pattern** - Notifica√ß√µes de mudan√ßas de estado
5. **Command Pattern** - Encapsulamento de opera√ß√µes
6. **Factory Pattern** - Cria√ß√£o de objetos complexos

### Princ√≠pios SOLID Aplicados

- **S** - Single Responsibility: Cada classe tem uma √∫nica responsabilidade
- **O** - Open/Closed: Aberto para extens√£o, fechado para modifica√ß√£o
- **L** - Liskov Substitution: Subtipos devem ser substitu√≠veis
- **I** - Interface Segregation: Interfaces espec√≠ficas e coesas
- **D** - Dependency Inversion: Depend√™ncia de abstra√ß√µes, n√£o implementa√ß√µes

### Estrutura de Diret√≥rios T√©cnica

```
FrontEmu-Tools/
‚îú‚îÄ‚îÄ üè¢ domain/                    # Camada de Dom√≠nio
‚îÇ   ‚îú‚îÄ‚îÄ entities/                 # Entidades de neg√≥cio
‚îÇ   ‚îú‚îÄ‚îÄ use_cases/               # Casos de uso
‚îÇ   ‚îî‚îÄ‚îÄ interfaces/              # Contratos/Interfaces
‚îú‚îÄ‚îÄ üì± application/               # Camada de Aplica√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ services/                # Servi√ßos de aplica√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ dtos/                    # Data Transfer Objects
‚îÇ   ‚îî‚îÄ‚îÄ mappers/                 # Mapeadores de dados
‚îú‚îÄ‚îÄ üîß infrastructure/            # Camada de Infraestrutura
‚îÇ   ‚îú‚îÄ‚îÄ adapters/                # Adaptadores externos
‚îÇ   ‚îú‚îÄ‚îÄ repositories/            # Implementa√ß√µes de reposit√≥rios
‚îÇ   ‚îî‚îÄ‚îÄ external/                # Servi√ßos externos
‚îú‚îÄ‚îÄ üé® presentation/              # Camada de Apresenta√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ widgets/                 # Componentes de UI
‚îÇ   ‚îú‚îÄ‚îÄ controllers/             # Controladores de UI
‚îÇ   ‚îî‚îÄ‚îÄ styles/                  # Estilos e temas
‚îú‚îÄ‚îÄ üß™ tests/                     # Testes automatizados
‚îÇ   ‚îú‚îÄ‚îÄ unit/                    # Testes unit√°rios
‚îÇ   ‚îú‚îÄ‚îÄ integration/             # Testes de integra√ß√£o
‚îÇ   ‚îî‚îÄ‚îÄ e2e/                     # Testes end-to-end
‚îî‚îÄ‚îÄ üìã docs/                      # Documenta√ß√£o t√©cnica
```

Esta arquitetura t√©cnica garante:
- ‚úÖ **Manutenibilidade** atrav√©s de c√≥digo limpo e bem estruturado
- ‚úÖ **Testabilidade** com separa√ß√£o clara de responsabilidades
- ‚úÖ **Extensibilidade** atrav√©s de interfaces bem definidas
- ‚úÖ **Performance** com cache inteligente e opera√ß√µes ass√≠ncronas
- ‚úÖ **Confiabilidade** com tratamento robusto de erros